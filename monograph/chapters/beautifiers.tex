

\chapter{Estado da Arte}
\label{source_code_beautifiers}

% \section{\lang{What does coding is}{Programação de computadores}}

\lang{
    Coding is like writing and
    reading a book for the large people,
    you like it to look beautifully.
    Or at least do you expect such when you buy a book,
    for example,
    to learn programming for you first time \cite{howNovicesRead}.
    You expect:
    \begin{enumerate}
        \item
            Things to be well organized,
            so you do not get lost;
        \item
            The colors to be properly placed,
            so you do not get distracted from the main content;
        \item
            The spacing between paragraphs,
            words, chapters, sections subsections, etc,
            to be well adjusted.
            Not everything cluttered in only one file,
            line, function, class,
            or whatsoever so;
    \end{enumerate}
}{%
    Programar pode ser considerado pela maioria das pessoas como escrever um livro,
    e para tal,
    a facilidade de leitura é desejável\advisor{.}{
    e
    gostar~=se mais caso este ``livro'' tenha uma boa aparência.%
    }
    Existem livros \advisor{muito horríveis de se ler.}{difíceis de ler}:
    fontes inadequadas ou
    pequenas,
    com folhas que brilham contra a luz.
    No mínimo espera~=se algumas características chave ao comprar~=se um livro \cite{visualizationsInAFunctionalProgramming}.
    Por exemplo,
    quando compra~=se um livro,
    \advisor{}{para aprender a programar pela primeira vez,
    }espera~=se que \cite{howNovicesRead}:
    \begin{enumerate}
        \item
            Seu conteúdo esteja bem organizado,
            para que o leitor não se perca durante sua leitura;
        \item
            Que suas cores \advisor{sejam}{estejam} propriamente escolhidas e
            utilizadas,
            para que elas não distraiam o leitor ou tirem o foco do principal,
            o conteúdo do livro;
        \item
            Que o espaçamento entre os parágrafos,
            palavras, capítulos, seções, subseções, etc, estejam propriamente ajustados,
            e não\advisor{}{ todo} aglomerado ou desordenado em um único parágrafo,
            frase, capítulo\advisor{.}{, etc.}
    \end{enumerate}
}


\advisor{}{%
    \section{\lang{Computer Assisted Programming}{Programação auxiliada}}

    \lang{%
        Your computer should help you with these unforeseen tasks.
        Why should I spend my precious time checking whether I am actually copying something space indented,
        when I am actually coping something tab indented?
        Perhaps we should sit and
        cry while waiting for some greater force to come and
        rescue us.
        Or may be you should stop crying and
        actually do something about other than keep waiting for you mommy to come and
        save you from the darkness growing behind you back leading you to endless unsleepy nights fixing your code just because everything just went wrong.
    }{%
        Seu computador deveria ajudar você com aquelas imprevistas tarefas.
        Por que eu deveria gastar meu precioso tempo verificando se algo que estou copiando,
        está indentado por ``TAB''\s ou
        espaços?
        Talvez devêssemos sentar e
        chorar enquanto aguardamos que alguma força maior do Universo venha e
        nos salve.
        Ou talvez você deva para de chorar e
        realmente fazer alguma coisa a respeito além de continuar esperando que sua mamãe venha e
        resgate você da escuridão crescendo pela suas costas levando você a infinitas noites acordado corrigindo seu código simplesmente por que tudo deu errado.
    }
}


\section{Formatadores de código}
\label{formatadores_de_codigo}

\lang{%
    A robust Code Beautifier can get a lot more complicated just with the basic definitions of formatting (\typeref{source_code_beautifiers}) applied over each language own characteristics as for example:
    \begin{enumerate}[nosep,nolistsep]
        \item
            Add spaces before if\s name as in `if(var)' versus `if (var)';
        \item
            Add spaces inside if\s as in `if(var)' versus `if( var )';
        \item
            Add spaces before for\s name as in `for(var)' versus `for (var)';
        \item
            Add spaces inside for\s as in `for(var)' versus `for( var )'.
    \end{enumerate}
}{%
    Conhecido como ``\textit{pretty~=printing}'' ou
    embelezadores\footnote{
    Do inglês,
    \textit{Source Code Beautifiers}.
    }
    \cite{prettyPrintingForSoftware},
    uma ferramenta de formatação pode ser complicada de se utilizar,
    somente com um conjunto básico de definições.
    Por exemplo,
    para permitir um melhor controle do usuário,
    a ferramenta de formatação pode permitir que exista uma configuração específica para cada aspecto da linguagem.

    Uma possível implementação para tal ajuste fino,
    pode ser uma configuração específica como por exemplo a entrada booleana ``\textit{use\_spaces\_after\_if}'',
    em um arquivo de configuração para definir caso deva~=se ou
    não ser adicionados espaços após cada ``if'' ao fazer a formatação da linguagem,
    i.e.,
    ``if (var)'' ao contrário de ``if(var)''.
}

\lang{
    As may be noticed,
    the list may became quite big,
    and if fact such big list of rules has been implemented.
    Looking over the Beautifier called `Uncrustify' \cite{uncrustifySourceCode},
    we can find about 500 settings with specifications like these above.
}{%
    Como pode ser percebido,
    uma lista contendo todas as configurações de formatação para cada aspecto da linguagem,
    ficará muito grande quando todos os aspectos das linguagens mais complexas como C ou
    C++ forem implementados.
    Em softwares como Uncrustify \cite{uncrustifySourceCode},
    encontra~=se mais de 500 configurações tais como o \typeref{uncrustifySettingSample},
    veja mais sobre configurações na \fullref{trabalhosRelacionados}.
}
\begin{lstlisting}[caption={Trecho do Arquivo de Configuração de Uncrustify},label={uncrustifySettingSample}]
# If the body of the namespace is longer than this
# number, it won't be indented. Requires
# indent_namespace=true. Default=0 (no limit)
indent_namespace_limit = 0  # number

# Whether the 'extern "C"' body is indented
indent_extern = false       # false/true

# Whether the 'class' body is indented
indent_class = true         # false/true

# Whether to indent the stuff after a
# leading base class colon
indent_class_colon = false  # false/true

# Whether to indent the stuff after a
# leading class initializer colon
indent_constr_colon = false # false/true
\end{lstlisting}

\lang{%
    The problem about is,
    even if you go through all these settings,
    which will take you quite some time,
    you still only configuring a few languages closely related.
    On this case,
    C, C++, Java, Pawn,
    etc.
    For all other languages you still need to find out another source code formatter tool,
    which will be certainly limited \cite{eclisePeriodSettings} and
    still need to configure all over again.
}{%
    O problema é,
    mesmo que se passe por todas essas configurações,
    realizando os ajustes de preferência do usuário,
    isso levará um bom tempo.
    Infelizmente,
    você ainda está apenas configurando uma e
    talvez algumas linguagens fortemente relacionadas,
    dependendo do suporte que a ferramenta oferece.

    No caso da ferramenta Uncrustify,
    serão configurados linguagens como \textit{C},
    \textit{C++}, \textit{C\#} e \textit{ObjectiveC},
    veja mais linguagens na \fullref{trabalhosRelacionados}.
    Para todos os outras linguagens,
    você ainda precisará encontrar outra ferramenta de formatação,
    que será certamente mais limitada no que ela pode customizar \cite{eclisePeriodSettings,uncrustifyNotMeetingCodingStandards},
    uma vez que Uncrustify já é uma das mais completas.

    Ao realiza~=se a migração de uma ferramenta de formatação como Uncrustify para outra,
    precisa~=se configurar novamente todas as novas opções já definidas para Uncrustify.
    Outra forte desvantagem do arquivo de configurações do Uncrustify segue na dificuldade de entender e
    visualizar o que está sendo configurado para que possa~=se realizar a migração.

    Algumas opções são claras e
    fáceis de se entender,
    já outras,
    não consegue~=se ter a mínima ideia do que elas estão fazendo e
    qual será o seu resultado final.
    Por exemplo,
    você consegue claramente entender o que a última regra do \typeref{uncrustifySettingSample} significa?
}

\advisor{}{%
    \lang{%
        Below there are some basic formatting rules for illustration:

        % \begin{bluebox}
        \begin{enumerate}[nosep,nolistsep]
            \item Add new lines after `\{' and before `\}';
            \item Add new lines before `\{';
            \item Remove empty lines;
            \item Add comment lines before function;
            \item Add new lines after `;';
            \item Add new lines after `\}';
            \item Remove new lines;
            \item Reduce whitespace;
            \item Fix bad indentation.
        \end{enumerate}
        % \end{bluebox}
        \vspace{-4mm}\begin{flushright}\textcite{prettyPrinter}\end{flushright}

        Mostly,
        code formatting is resumed into this set of changes.
    }{%
    }
}


\section{\lang{For what is their use?}{Qual a utilidade de Formatadores?}}

\advisor{%
    Pode~=se compreender uma frase sem pontuação,
    mas é mais fácil de fazer essa operação utilizando~=as.
    Por exemplo:

    \noindent
    umaboapontuacaocomcertezatornamascoisasmaisfaceisdeseler

    Um leitor hábil pode compreender facilmente a oração acima,
    mas a pontuação tornaria a tarefa mais fácil \cite{theTidyverseStyleGuide}.
}{%
    Um bom estilo de formatação é como uma boa pontuação,
    você consegue viver sem \cite{theTidyverseStyleGuide}:

    \noindent
    mascomcertezatornamascoisasmaisfaceisdeseler
}

\lang{%
    For now could not find any strong evidence or
    correlation about code comprehension and
    source code beautifying \cite{improvingCodeReadability},
    except perhaps for team annoyance:
}{%
    Não pôde~=se encontrar nenhuma forte evidência\footnote{
    Com forte evidência refere~=se a afirmações absolutas como:
    ``--Ao utilizar formatadores de código,
    é garantido que seu projeto de desenvolvimento de código~=fonte irá sofre ganhos em tempo de desenvolvimento e
    qualidade de software''.
    }
    ou
    relação sobre a compreensão de códigos~=fonte e
    formatadores de código.
    Alguns estudos como \citeonline{improvingCodeReadability} implementam modelos de Inteligências Artificiais utilizados para classificar códigos~=fonte como ``bem legíveis'' ou
    ``mal legíveis''.
    Inicialmente estes estudos começam coletando dados de pessoas classificando códigos~=fonte como legíveis ou
    não,
    para então treinar Inteligências Artificiais classificando códigos~=fonte.

    Além desse estudo científico para classificar códigos~=fonte,
    encontra~=se em outros lugares como \citeonline{pep8operatorsBlankLine} dicas ou
    notas explicando quais características de formatação de código~=fonte ajudam ou
    prejudicam a legibilidade de código.
}%
\begin{citacao}
    % \setlength{\itemindent}{5pt}
    Um dos melhores métodos de destruição de equipes de desenvolvedores de software,
    é engajar~=se em guerras de formatação passiva~=agressiva.
    Elas destroem os relacionamentos entre colegas,
    e dependendo do tipo de formatação feita,
    também podem prejudicar a capacidade de comparar efetivamente as revisões no sistema de controle de versão,
    o que é realmente assustador.
    Não pode~=se nem imaginar o quão ruim seria caso a liderança das equipes fosse a culpada por esse comportamento.
    Isso que é liderar por exemplo.
    Por mau exemplo.
    \cite[tradução nossa\protect\footnotemark]{deathToTheSpaceInfidels}\footnotetext{
    \englishword{%
    One of absolute worst,
    worst methods of teamicide for software developers is to engage in these kinds of passive~=aggressive formatting wars.
    I know because I've been there.
    They destroy peer relationships,
    and depending on the type of formatting,
    can also damage your ability to effectively compare revisions in source control,
    which is really scary.
    I can't even imagine how bad it would get if the lead was guilty of this behavior.
    That's leading by example,
    all right.
    Bad example.
    }}.
\end{citacao}

\lang{%
    On \citeonline{programIndentation} was analyzed the level of program comprehension which can be gained by the indentation and
    was comprehended that the indentation levels of 2 and
    4 spaces proved to have the best comprehension levels again other levels.
}{%
    Em \citeonline{programIndentation} foi analisado o nível de compreensão do programa que pode ser obtido pela indentação e
    foi constatado que os níveis de indentação de 2 e
    4 espaços provaram ter os melhores níveis de compreensão do que outros níveis.
}%
\begin{citacao}
    % \setlength{\itemindent}{5pt}
    Por mais absurdo que possa parecer,
    lutar sobre espaços em branco e
    outras questões aparentemente triviais de layout de código~=fonte é realmente justificado.
    Desde que feito com moderação,
    abertamente,
    de uma forma justa e
    com construção de consenso,
    sem esfaquear companheiros de equipe ao longo do caminho.
    \cite[tradução nossa\protect\footnotemark]{deathToTheSpaceInfidels}\footnotetext{
    \englishword{%
    So yes,
    absurd as it may sound,
    fighting over whitespace characters and
    other seemingly trivial issues of code layout is actually justified.
    Within reason of course -- when done openly,
    in a fair and
    concensus building way,
    and without stabbing your teammates in the face along the way.
    }}.
\end{citacao}

Como não pode~=se dizer certamente que ao utilizar ferramentas de formatação irá~=se ter um melhor desempenho,
cabe a cada desenvolvedor ou
time de desenvolvimento decidir por si e
sua experiência se ele sente a necessidade de algo mais durante o período de desenvolvimento.


\section{\lang{Related Works}{Trabalhos Relacionados}}
\label{trabalhosRelacionados}

Nesta seção,
são relatados os trabalhos relacionados obtidos através de pesquisa na literatura utilizando metodologia especificada no \typeref{firstChapterIntroduction}.
Segundo \citeonline{uncrustifySourceCode},
Uncrustify é capaz de formatar as linguagens:
\begin{inparaenum}[1)]
\item C;
\item C++;
\item C\#;
\item ObjectiveC;
\item D;
\item Java;
\item Pawn e;
\item VALA.
\end{inparaenum}%
De acordo com o site \citetitle{uncrustifyWebSite},
a versão ``0.69.0'' possui 671 configurações para personalizar a formatação do código~=fonte como mostrado no \typeref{uncrustifySettingSample}.

Existem muitas ferramentas e\slash{}ou editores de texto,
e cada uma dessas ferramentas possuí suas vantagens e
desvantagens \cite{prettyPrintingOfVisualSentences,anAbstractPrettyPrinter,improvingRefactoringSpeed}.
Por isso,
alguns desenvolvedores de software\advisor{}{
que são mais inquietos ou
entusiastas por novas tecnologias
} podem utilizar simultaneamente duas ou
mais ferramentas dependendo de suas especialidades e
da tarefa que o desenvolvedor está realizando no momento.

Trabalhos como \citeonline{editorConfig} não são diretamente um formatador de código~=fonte\advisor{.}{,
tema foco desta monografia.
} Mas sua relação com este trabalho é seu proposito de servir como uma ponte de compartilhamento de configurações entre todos os editores de texto.
Com isso,
facilitando a troca de um editor pelo outro durante o desenvolvimento.
Do mesmo jeito,
este trabalho foca em propor uma ferramenta de formatação extensível várias linguagens de programação (Veja o \fullref{software_implementation}).

\citeonline{universalIndentGUI} é outra ferramenta que não é um formatador de código~=fonte,
mas sim uma interface comum a várias e
diferentes ferramentas de formatação de código~=fonte.
Na \typeref{UniversalIndentGUIScreenshot4} pode~=se ver como é a interface com o usuário que esta ferramenta proporciona.

\begin{figure}[h]
\centering
\includegraphics[width=1.0\textwidth]{UniversalIndentGUIScreenshot4.png}
\caption[Exemplo da Tela de Configuração de UniversalIndentGUI]{Exemplo da Tela de Configuração de UniversalIndentGUI -- \cite{UniversalIndentGUIScreenshot4}}
\label{UniversalIndentGUIScreenshot4}
\end{figure}

A interface da \typeref{UniversalIndentGUIScreenshot4} permite que se escolha qual será o formatador de código que será utilizado,
e permite que carregue~=se um arquivo de código~=fonte para ser formatado,
e na medida que seleciona~=se as opções pela interface gráfica,
pode~=se visualizar as mudanças no código~=fonte de exemplo carregado.
Entretanto,
\citeonline{universalIndentGUI} enfrenta problemas como as limitações de sua interface gráfica.
Como já mencionado na \typeref{trabalhosRelacionados},
Uncrustify na sua versão ``0.69.0'' possuí 671 configurações de formatação de código~=fonte,
mas a interface gráfica de \citeonline{universalIndentGUI} não possui\advisor{
tal número}{
nem próximo de tantas} opções de configuração.

Todas as opções que não aparecem na interface gráfica de \citeonline{universalIndentGUI},
não podem ser utilizadas ao realizar a formatação do código~=fonte porque os arquivos de configuração gerados e
lidos pela ferramenta não conterão estas opções.
Qualquer outra opção adicional inserida manualmente pelo usuário será apagada,
assim não podendo ser utilizadas mais opções além das quais a\advisor{}{
limitada} interface gráfica apresenta.

Outra desvantagem da visualização das mudanças,
como mostrado na \typeref{UniversalIndentGUIScreenshot4},
acontece quando o código~=fonte de amostra carregado não contém partes que são afetados\slash{}formatados pela configuração utilizada.
Nesse caso,
não será apresentado nenhuma mudança durante a visualização.

Com o que foi apresentado sobre as ferramentas de formatação de código~=fonte,
já pode~=se ter uma visão sobre como funcionam e
são todas as ferramentas de formatação.
Ou elas serão configuradas diretamente pelo usuário,
editando arquivos de configuração \cite{uncrustifySourceCode},
ou elas terão uma interface gráfica que permita com que o usuário visualize as suas alterações diretamente em uma amostra de código~=fonte \cite{universalIndentGUI}.

Quanto ao seu funcionamento interno,
formatadores de código~=fonte seguem o processo de tradução como apresentado na \fullref{compiladoresEtradutores}.
Diferentemente do usual para um tradutor,
um formatador realiza um processo de tradução onde o nível da linguagem e
a própria linguagem de origem e
destino são o mesmo.
Por exemplo,
ao realizar a tradução de um programa em \textit{C++} para \textit{C++}.


\section{\lang{Obfuscators}{Ofuscadores}}

Ofuscadores\footnote{Do inglês,
\textit{Obfuscator},
\citetitle{obfuscationWikipedia}.
}
são formatadores de código~=fonte que funcionam com objetivo contrário ao dos \textit{Beautifiers},
veja o \typeref{exemploDeOfuscador}.
Em vez de melhorar a leitura do código~=fonte,
sua função é impossibilitar que o código~=fonte seja compreendido.
Tais técnicas e
utilidades para estes tipos de software podem ser encontradas com mais detalhes em \citeonline{codeObfuscationTechniques}.
\begin{quadro}[h]
\caption[Exemplo de Ofuscador de Código]{Exemplo de Ofuscador de Código \cite{familyOfSourceCodeObfuscators}}
\label{exemploDeOfuscador}
\begin{bluebox}
\begin{code}
\caption{Antes do ofuscamento}
\begin{minted}[xleftmargin=2em]{javascript}
for (i=0; i < M.length; i++)
{
   // Adjust position of clock hands
   var ML = (ns) ? document.layers['nsMinutes' + i]:ieMinutes[i].style;

   ML.top = y[i] + HandY + ( i*HandHeight ) * Math.sin(min) + scroll;
   ML.left = x[i] + HandX + ( i*HandWidth ) * Math.cos(min);
}
\end{minted}
\end{code}

\begin{code}
\caption{Antes do ofuscamento}
\begin{minted}[xleftmargin=2em]{javascript}
for(O79=0;O79<l6x.length;O79++){var O63=(l70)?
document.layers["nsM\151\156u\164\145s"+O79]:
ieMinutes[O79].style;O63.top=l61[O79]+O76+(O79*O75)
*Math.sin(O51)+l73;O63.left=l75[O79]+l77+(O79*l76)
*Math.cos(O51);}
\end{minted}
\end{code}
\end{bluebox}
\end{quadro}

Dentre as utilidades dos Ofuscadores está minimizar a quantidade de dados transmitidos entre um Servidor e
um Cliente Web ao reduzir o tamanho dos arquivos de linguagens como \textit{JavaScript},
quando eles são baixados pelos Navegadores de Internet ao acessar um site que utiliza essas linguagens de script.
Como exemplo,
pode~=se imaginar um arquivo com grande volume de comentários\advisor{.}{
de documentação.} Nesse arquivo,
a transmissão dos comentários pode ser considerada inútil e
consequentemente podem removidos.
Portanto,
fazendo seu ofuscamento pode~=se reduzir seu tamanho em até pela metade ou
mais.

Eventualmente,
existem linguagens onde o uso de ofuscadores possui limitações.
Por exemplo,
diferente da linguagem \textit{JavaScript} utilizada no \typeref{exemploDeOfuscador},
a sintaxe da linguagem YAML\footnote{
Do inglês,
YAML \textit{Ain't Markup Language},
i.e.,
a sigla de YAML é uma definição recursiva.
}
\cite{yamlSpecificModelChecking} obrigatoriamente deve utilizar espaços para indentação e
linhas novas para separar blocos de informação.
Tais características enfraquecem o poder do ofuscamento uma vez que ele possui um maior efeito quando pode~=se introduzir maior caos no documento,
removendo~=se as indentações e
linhas novas. Entretanto,
mesmo sem esses elementos chave,
ainda pode~=se introduzir caos removendo todos os comentários e
renomeando variáveis para nomes \advisor{sem significo de uso}{obtusos\footnote{Sem significo de uso.}} como ``A88''.


\advisor{}{%
\subsection{Lista de curiosidades}

\lang{%
    On a distributed version control system,
    continuous integration would be continuously running the system tests as long new code is integrated into main system from the distributed clients \cite{continuousIntegration}.
}{}

\begin{enumerate}
    % https://tex.stackexchange.com/questions/123104/inline-citations-with-only-author-title-and-year
    \item \citeauthortitleyear{trackingChanges};
    \item \citeauthortitleyear{aspectOriented};
    \item \citeauthortitleyear{annotationAssistant};
    \item \citeauthortitleyear{codePlagiarismDetection};
    \item \citeauthortitleyear{softwarePortfolio};
    \item \citeauthortitleyear{legacyAssets};
    \item \citeauthortitleyear{massMaintenance};
    \item \citeauthortitleyear{prettyPrinting};
    \item \citeauthortitleyear{architectureFormatting};
    \item \citeauthortitleyear{independentFramework};
    \item \citeauthortitleyear{industrialApplication};
    \item \citeauthortitleyear{toolsForProjectManagement};
    \item \citeauthortitleyear{codeClassification};
    \item \citeauthortitleyear{codeScanningPatterns};
    \item \citeauthortitleyear{debuggingIntoExamples};
    \item \citeauthortitleyear{programUnderstanding};
    \item \citeauthortitleyear{documentingAndSharingKnowledge};
    \item \citeauthortitleyear{autofoldingForSourceCode};
    \item \citeauthortitleyear{learningSupportSystem};
    \item \citeauthortitleyear{syntaxHighlightingInfluencing};
    \item \citeauthortitleyear{improvingCodeReadability};
    \item \citeauthortitleyear{howNovicesRead};
    \item \citeauthortitleyear{theRoleOfMethodChains};
    \item \citeauthortitleyear{codeComprehensionComparedToOO};
    \item \citeauthortitleyear{enhancingLegacySoftwareSystemAnalysis};
    \item \citeauthortitleyear{moldableCodeEditor};
    \item \citeauthortitleyear{blindAndSightedProgrammers};
    \item \citeauthortitleyear{pushdownAutomata};
    \item \url{https://github.com/r-lib/styler};
    \item \url{https://github.com/github/linguist};
    \item \url{https://github.com/wbond/package_control_channel/issues/4310} Write a formatter utility;
    \item \url{https://github.com/PyCQA/pydocstyle};
    \item \url{https://github.com/PyCQA/pycodestyle};
    \item \url{https://blog.codinghorror.com/check-in-early-check-in-often/};
    \item \url{https://www.youtube.com/watch?v=2GqpdfIAhz8};
    \item \url{http://langserver.org/};
    \item \url{https://github.com/Microsoft/language-server-protocol};
    \item \url{https://github.com/SublimeCodeIntel/SublimeCodeIntel};
    \item \url{https://code.visualstudio.com/blogs/2016/06/27/common-language-protocol};
    \item \url{https://www.eclipse.org/community/eclipse_newsletter/2017/may/article1.php};
    \item \url{https://github.com/Microsoft/language-server-protocol/wiki/Protocol-Implementations}.
\end{enumerate}
}
