

\chapter{Source Code Beautifiers}
\label{source_code_beautifiers}


% \section{\lang{What does coding is}{Programação de computadores}}

\lang{
    Coding is like writing and reading a book for the large people, you like it
    to look beautifully. Or at least do you expect such when you buy a book, for
    example, to learn programming for you first time \cite{howNovicesRead}.
    You expect:
    \begin{enumerate}
        \item
            Things to be well organized,
            so you do not get lost.
        \item
            The colors to be properly placed,
            so you do not get distracted from the main content.
        \item
            The spacing between paragraphs, words, chapters, sections
            subsections, etc, to be well adjusted.
            Not everything cluttered in only one file,
            line, function, class, or whatsoever so.
    \end{enumerate}
}{%
    Programar pode ser considerado pela maioria das pessoas como escrever um livro,
    e para tal,
    \advisor{busca~=se mais a ideia de facilidade de leitura.
    Existem livros muito horríveis de se ler:
    fontes inadequadas ou pequenas,
    com folhas que brilham contra a luz.
    }{gostar~=se mais caso este ``livro'' tenha uma boa aparência.
    }No mínimo espera~=se algumas características chave ao comprar~=se
    um livro \cite{visualizationsInAFunctionalProgramming}.
    Por exemplo,
    quando compra~=se um livro,
    \advisor{}{para aprender a programar pela primeira vez,
    }espera~=se que \cite{howNovicesRead}:
    \begin{enumerate}
        \item
            Seu conteúdo esteja bem organizado,
            para que o leitor não se perca durante sua leitura.
        \item
            Que suas cores \advisor{sejam}{estejam} propriamente escolhidas e
            utilizadas,
            para que elas não distraiam o leitor ou tirem o foco do principal,
            o conteúdo do livro.
        \item
            Que o espaçamento entre os parágrafos,
            palavras, capítulos, seções, subseções, etc, estejam propriamente ajustados,
            e não\advisor{}{ todo} aglomerado ou desordenado em um único parágrafo,
            frase, capítulo\advisor{.}{, etc.}
    \end{enumerate}
}

\advisor{}{%
    \section{\lang{Computer Assisted Programming}{Programação auxiliada}}

    \lang{%
        Your computer should help you with these unforeseen tasks.
        Why should I spend my precious time checking whether I am actually copying
        something space indented,
        when I am actually coping something tab indented?
        Perhaps we should sit and cry while waiting for some greater force to come
        and rescue us. Or may be you should stop crying and actually do something
        about other than keep waiting for you mommy to come and save you from the
        darkness growing behind you back leading you to endless unsleepy nights
        fixing your code just because everything just went wrong.
    }{%
        Seu computador deveria ajudar você com aquelas imprevistas tarefas.
        Por que eu deveria gastar meu precioso tempo verificando se algo que estou copiando,
        está indentado por ``TAB''\s ou espaços?
        Talvez devêssemos sentar e
        chorar enquanto aguardamos que alguma força maior do Universo venha e
        nos salve.
        Ou talvez você deva para de chorar e
        realmente fazer alguma coisa a respeito além de continuar esperando que sua mamãe venha e
        resgate você da escuridão crescendo pela suas costas levando você a infinitas noites
        acordado corrigindo seu código simplesmente por que tudo deu errado.
    }
}


\section{Formatadores de código}

\lang{%
    A robust Code Beautifier can get a lot more complicated just with the basic
    definitions of formatting (\nameref{source_code_beautifiers})
    applied over each language own characteristics
    as for example:
    \begin{enumerate}[nosep,nolistsep]
        \item
            Add spaces before if\s name as in `if(var)' versus `if (var)'
        \item
            Add spaces inside if\s as in `if(var)' versus `if( var )'
        \item
            Add spaces before for\s name as in `for(var)' versus `for (var)'
        \item
            Add spaces inside for\s as in `for(var)' versus `for( var )'
    \end{enumerate}
}{%
    Conhecido como ``pretty~=printing'' ou
    embelezadores\footnote{Do inglês \textit{Beautifiers}} \cite{prettyPrintingForSoftware},
    uma ferramenta de formatação pode ser complicada de se utilizar,
    somente com um conjunto básico de definições.
    Por exemplo,
    para permitir um melhor controle do usuário,
    a ferramenta de formatação pode permitir que exista uma configuração específica para cada aspecto da linguagem.

    Uma possível implementação para tal ajuste fino,
    pode ser uma configuração específica como por exemplo a entrada booleana ``\textit{use\_spaces\_after\_if}'',
    em um arquivo de configuração para definir caso deva~=se ou
    não ser adicionados espaços antes de cada ``if'' ao fazer a formatação da linguagem,
    por exemplo,
    ``if (var)'' ao contrário de ``if(var)''.
}

\lang{
    As may be noticed, the list may became quite big,
    and if fact such big list of rules has been implemented.
    Looking over the Beautifier called
    `Uncrustify'\footnote{\url{https://github.com/uncrustify/uncrustify}},
    we can find about 500 settings with specifications like these above.
}{%
    Como pode ser percebido,
    uma lista contendo todas as configurações de formatação para cada aspecto da linguagem,
    ficará muito grande quando todos os aspectos das linguagens mais complexas como C ou
    C++ forem implementados.
    Em softwares como \textit{Uncrustify}\footnote{\url{https://github.com/uncrustify/uncrustify}},
    encontra~=se mais de 500 configurações tais como o Código \ref{lst:uncrustifySettingSample}.
}
\begin{lstlisting}[caption={Trecho do Arquivo de Configuração de
\textit{Uncrustify}},label={lst:uncrustifySettingSample}]
# If the body of the namespace is longer than this
# number, it won't be indented. Requires
# indent_namespace=true. Default=0 (no limit)
indent_namespace_limit = 0  # number

# Whether the 'extern "C"' body is indented
indent_extern = false       # false/true

# Whether the 'class' body is indented
indent_class = true         # false/true

# Whether to indent the stuff after a
# leading base class colon
indent_class_colon = false  # false/true

# Whether to indent the stuff after a
# leading class initializer colon
indent_constr_colon = false # false/true
\end{lstlisting}

\lang{%
    The problem about is, even if you go through all these settings,
    which will take you quite some time,
    you still only configuring a few languages closely related.
    On this case, C, C++, Java, Pawn, etc.
    For all other languages you still need to find out another source code
    formatter tool, which will be certainly
    limited\footnote{\url{https://stackoverflow.com/questions/31438377/how-can-i-get-eclipse-to-wrap-lines-after-a-period-instead-of-before}}
    and still need to configure all over again.
}{%
    O problema é,
    mesmo que se passe por todas essas configurações,
    realizando os ajustes de preferência do usuário,
    isso levará um bom tempo.
    Infelizmente,
    você ainda está apenas configurando uma e
    talvez algumas linguagens fortemente relacionadas,
    dependendo do suporte que a ferramenta oferece.

    No caso da ferramenta \textit{Uncrustify},
    serão configurados as linguagens \textit{C},
    \textit{C++}, \textit{Java}, \textit{Pawn}\advisor{.}{,
    etc.} Para todos os outras linguagens,
    você ainda precisará encontrar outra ferramenta de formatação,
    que será certamente mais limitada no que ela pode customizar \cite{eclisePeriodSettings},
    uma vez que \textit{Uncrustify} já é uma das mais completas.

    Além disso,
    ainda precisa~=se configurar todas as novas opções já configuradas.
    Outra forte desvantagem do arquivo de configurações do \textit{Uncrustify} segue na dificuldade de entender e
    visualizar o que está sendo configurado.

    Algumas opções são claras e
    fáceis de se entender,
    já outras,
    não consegue~=se ter a mínima ideia do que elas estão fazendo e
    qual será o seu resultado final.
    Por exemplo,
    você consegue claramente entender o que a última regra do Código \ref{lst:uncrustifySettingSample} significa?
}

\advisor{}{%
    \lang{%
        Below there are some basic formatting rules for illustration:

        % \begin{bluebox}
        \begin{enumerate}[nosep,nolistsep]
            \item Add new lines after `\{' and before `\}'
            \item Add new lines before `\{'
            \item Remove empty lines
            \item Add comment lines before function
            \item Add new lines after `;'
            \item Add new lines after `\}'
            \item Remove new lines
            \item Reduce whitespace
            \item Fix bad indentation
        \end{enumerate}
        % \end{bluebox}
        \vspace{-4mm}\begin{flushright}\textcite{prettyPrinter}\end{flushright}

        Mostly,
        code formatting is resumed into this set of changes.
    }{%
    }
}


\section{\lang{For what is their use?}{Qual a utilidade de Formatadores?}}

\url{https://www.python.org/dev/peps/pep-0008/#should-a-line-break-before-or-after-a-binary-operator}



For now could not find any strong evidence or correlation about code
comprehension and source code beautifying \cite{improvingCodeReadability},
except perhaps for team annoyance:

\begin{citacao}
% \setlength{\itemindent}{5pt}
One of absolute worst, worst methods of teamicide for software developers is to engage
in these kinds of passive-aggressive formatting wars. I know because I've been there.
They destroy peer relationships, and depending on the type of formatting, can also damage
your ability to effectively compare revisions in source control, which is really scary.
I can't even imagine how bad it would get if the lead was guilty of this behavior. That's
leading by example, all right. Bad example. \cite{Atwood}
\end{citacao}

On \citeonline{improvingCodeReadability} was analyzed the level of program
comprehension which can be gained by the indentation and was constated that
the indentation levels of 2 and 4 spaces proved to have the best
comprehension levels again other levels.

\begin{citacao}
So yes, absurd as it may sound, fighting over whitespace characters and other seemingly
trivial issues of code layout is actually justified. Within reason of course -- when done
openly, in a fair and concensus building way, and without stabbing your teammates in the
face along the way. \cite{Atwood}
\end{citacao}



\section{Application Fields}

TODO.

\url{https://github.com/r-lib/styler}
\url{https://github.com/github/linguist}
\url{https://forum.sublimetext.com/t/auto-align-symbolic/34375}
\url{https://github.com/Thom1729/SmartIndent}
\url{https://github.com/wbond/package_control_channel/issues/4310} Write a formatter utility
\url{https://github.com/PyCQA/pydocstyle}
\url{https://github.com/PyCQA/pycodestyle}



\subsection{Configuration Detection}

If found on the project root folder,
a folder named `.object-beauty',
it will be used to store the automatically generated configurations based on the current configuration\s rules.
Such thing,
cannot be easily implemented because of the various complexities which can be introduced into the formatting rules.
For example,
the if configurations rules are simple and limited to just changing simple aspects of the formatting,
then the configuration generation will also be simple,
because there are only a few aspects to analyze.
However,
as the formatting rules grow up,
their complexity equally proportionally grows,
due the increased count of possibilities to analyze when combined together.


\subsection{Multidirectional Translation}

With this ObjectBeautifier,
we can edit XML files like YAML files,
because the when we load the XML,
we create a copy (the YAML version of the XML) on the `.object-beauty` folder which is edited by Sublime Text,
and let the XML on its original place.
Then when we save our YAML copy,
we translate it to the XML original copy.
Similarly,
for a C language code,
it would be like to change some bit on the compiled binary code and have the change reflected on the original C source code.
\url{https://github.com/Microsoft/XmlNotepad}

Open Source Neural Machine Translation in Torch,
translates between languages by machine learning.
\url{https://github.com/OpenNMT/OpenNMT}



\citeonline{annotationAssistant},
\citeonline{codePlagiarismDetection},
\citeonline{softwarePortfolio},
\citeonline{legacyAssets},
\citeonline{massMaintenance},
\citeonline{prettyPrinting},
\citeonline{architectureFormatting},
\citeonline{independentFramework},
\citeonline{programIndentation},
\citeonline{industrialApplication},
\citeonline{toolsForProjectManagement},
\citeonline{codeClassification},
\citeonline{codeScanningPatterns},
\citeonline{debuggingIntoExamples},
\citeonline{programUnderstanding},
\citeonline{documentingAndSharingKnowledge},
\citeonline{autofoldingForSourceCode},
\citeonline{learningSupportSystem},
\citeonline{syntaxHighlightingInfluencing},
\citeonline{improvingCodeReadability},
\citeonline{howNovicesRead},
\citeonline{theRoleOfMethodChains},
\citeonline{codeComprehensionComparedToOO},
\citeonline{enhancingLegacySoftwareSystemAnalysis},
\citeonline{moldableCodeEditor},
\citeonline{blindAndSightedProgrammers},
\citeonline{pushdownAutomata},



\section{Continuous Integration}

TODO

On a distributed version control system,
continuous integration would be continuously running the system tests
as long new code is integrated into main system
from the distributed clients \cite{continuousIntegration}.

\begin{enumerate}[leftmargin=*]
    \item \citeonline{trackingChanges},
    \item \footnote{\url{https://blog.codinghorror.com/check-in-early-check-in-often/}}
    \item \cite{aspectOriented}
\end{enumerate}



\section{Language Server Protocol}

TODO.

\url{https://www.youtube.com/watch?v=2GqpdfIAhz8}
\url{http://langserver.org/}
\url{https://github.com/Microsoft/language-server-protocol}
\url{https://github.com/SublimeCodeIntel/SublimeCodeIntel}
\url{https://code.visualstudio.com/blogs/2016/06/27/common-language-protocol}
\url{https://www.eclipse.org/community/eclipse_newsletter/2017/may/article1.php}
\url{https://github.com/Microsoft/language-server-protocol/wiki/Protocol-Implementations}



\section{\lang{Related Works}{Trabalhos Relacionados}}

\url{http://editorconfig.org/}
\cite{prettyPrintingOfVisualSentences}
\cite{anAbstractPrettyPrinter}
\cite{improvingRefactoringSpeed}

